---
title: "Cardiff STL Report"
output: pdf_document
header-includes:
  - \usepackage{comment}
params:
  tables: NA
  maps: NA
  crimes: NA
  month: NA
  yr: NA
  stlbound: NA
  dist: NA
  hood: NA
  baseurl: NA
---

```{r include=FALSE}
# load dependencies
library(ggplot2)
library(dplyr)
library(sf)
library(grid)
library(gridExtra)
library(httr)
library(magrittr)

# reproject shapes
stl <- st_transform(params$stlbound, "+proj=tmerc +lat_0=35.83333333333334 +lon_0=-90.5 +k=0.999933 +x_0=250000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 no_defs")
dist <- st_transform(params$dist, "+proj=tmerc +lat_0=35.83333333333334 +lon_0=-90.5 +k=0.999933 +x_0=250000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 no_defs")
hood <- st_transform(params$hood, "+proj=tmerc +lat_0=35.83333333333334 +lon_0=-90.5 +k=0.999933 +x_0=250000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 no_defs")

#define map theme
theme_map <- function(){
  theme(axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text = element_blank())
}
```

`r if("Summary Table" %in% params$tables) {"\\begin{comment}"}`
## Summary Table
```{r echo=FALSE}
dta <- api_call("api.bransonf.com/stlcrime/", paste0("coords?year=", params$yr, "&month=", params$month))

dta %<>% group_by(ucr_category) %>%
  summarise(Count = n()) %>%
  filter(ucr_category %in% params$crimes) %>%
  rename(Crime = ucr_category)

grid.table(dta, rows = NULL)

```
`r if("Summary Table" %in% params$tables) {"\\end{comment}"}`




 